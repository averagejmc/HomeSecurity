<!DOCTYPE html>
<html>
<head>
    <title>Home Security Dashboard</title>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <style>
        /* Global Styles */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 40px;
            margin: 0;
            background: linear-gradient(135deg, #ece9e6, #ffffff);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        h1 {
            color: #333;
            margin-bottom: 40px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
        }

        /* Dashboard Grid */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            width: 100%;
            max-width: 900px;
            margin-bottom: 30px; /* Added margin for button spacing */
        }

        /* Sensor Card Styles */
        .sensor-box {
            padding: 30px;
            border-radius: 12px;
            color: #fff;
            font-size: 1.3em;
            font-weight: 600;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: background-color 0.4s ease, transform 0.2s ease;
        }

        .sensor-box:hover {
            transform: translateY(-5px);
        }

        /* Initial Colors */
        #motion { background-color: #ff6b6b; }
        #door   { background-color: #4cd137; }
        #rfid   { background-color: #40739e; }

        /* State Colors */
        .motion-detected { background-color: #ff4757 !important; }
        .motion-clear { background-color: #ff6b6b !important; }

        .door-open { background-color: #ffa502 !important; }
        .door-closed { background-color: #4cd137 !important; }

        .rfid-active { background-color: #3742fa !important; }

        /* Arm Button Styles */
        #arm-btn {
            padding: 15px 30px;
            font-size: 1.2em;
            font-weight: bold;
            color: #fff;
            background-color: #007bff; /* Primary Blue */
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease;
            box-shadow: 0 4px 10px rgba(0, 123, 255, 0.3);
        }

        #arm-btn:hover {
            background-color: #0056b3;
        }

        #arm-btn:active {
            transform: scale(0.98);
        }
    </style>
</head>
<body>
    <h1>Home Security Dashboard</h1>

    <!-- System status display -->
    <div id="system-status" 
         style="margin-bottom:20px; font-size:1.4em; font-weight:bold; color:#333;">
         System is <span style="color:green">DISARMED</span>
    </div>

    <div class="dashboard">
        <div id="motion" class="sensor-box">Motion: Unknown</div>
        <div id="door" class="sensor-box">Door: Unknown</div>
        <div id="rfid" class="sensor-box">Last RFID: None</div>
    </div>

    <div style="display:flex; gap:15px; margin-top:20px;">
    <button id="arm-btn" onclick="toggleSecurity()">Arm System</button>
    <button id="logs-btn" onclick="window.location.href='/logs'">View Logs</button>
    </div>


    <script>
        let armed = false;

        function toggleSecurity() {
            armed = !armed;
            // Update button
            const btn = document.getElementById("arm-btn");
            btn.innerText = armed ? "Disarm System" : "Arm System";
            btn.style.backgroundColor = armed ? "#dc3545" : "#007bff"; // red when armed, blue when disarmed

            // Update status text
            const status = document.getElementById("system-status");
            status.innerHTML = armed 
                ? "System is <span style='color:red'>ARMED</span>" 
                : "System is <span style='color:green'>DISARMED</span>";

            // Send armed status to backend
            fetch('/toggle_security', { 
                method: 'POST', 
                body: JSON.stringify({armed: armed}), 
                headers: {'Content-Type': 'application/json'} 
            })
            .then(response => {
                if (!response.ok) {
                    console.error('Failed to toggle security status.');
                }
            })
            .catch(error => {
                console.error('Error sending toggle request:', error);
            });
        }

        var socket = io();
        socket.on("mqtt_message", function(msg){
            let topic = msg.data.split(":")[0];
            let payload = msg.data.split(":")[1].trim();

            if(topic === "home/motion"){
                document.getElementById("motion").innerText = "Motion: " + payload;
                document.getElementById("motion").className = "sensor-box " + (payload.includes("detected") ? "motion-detected" : "motion-clear");
            } 
            else if(topic === "home/door"){
                document.getElementById("door").innerText = "Door: " + payload;
                document.getElementById("door").className = "sensor-box " + (payload.includes("open") ? "door-open" : "door-closed");
            } 
            else if(topic === "home/rfid"){
                document.getElementById("rfid").innerText = "Last RFID: " + payload;
                document.getElementById("rfid").className = "sensor-box rfid-active";
            }
        });
    </script>
</body>
